<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>01-shiro 4集成 Spring</title>
    
<style id="wiz_custom_css">html, body {font-size: 12pt;}body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.6;margin: 0 auto;padding: 20px 16px;padding: 1.25rem 1rem;}h1, h2, h3, h4, h5, h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}h1 {font-size:20pt;font-size:1.67rem;}h2 {font-size:18pt;font-size:1.5rem;}h3 {font-size:15pt;font-size:1.25rem;}h4 {font-size:14pt;font-size:1.17rem;}h5 {font-size:12pt;font-size:1rem;}h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}div, p, ul, ol, dl, li {margin:0;}blockquote, table, pre, code {margin:8px 0;}ul, ol {padding-left:32px;padding-left:2rem;}ol.wiz-list-level1 > li {list-style-type:decimal;}ol.wiz-list-level2 > li {list-style-type:lower-latin;}ol.wiz-list-level3 > li {list-style-type:lower-roman;}blockquote {padding:0 12px;padding:0 0.75rem;}blockquote > :first-child {margin-top:0;}blockquote > :last-child {margin-bottom:0;}img {border:0;max-width:100%;height:auto !important;margin:2px 0;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td, th {padding:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;min-height:28px;word-break:break-all;box-sizing: border-box;}.wiz-hide {display:none !important;}</style></head>

<body class=""  spellcheck="false"><div></div><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><br></h2><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>集成 Spring</span></h2><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 加入 Spring 和 Shiro 的 jar 包</span><br><span style="padding-right:0.1px;">• 配置 Spring 及 SpringMVC</span><br><span style="padding-right:0.1px;">• 参照：1.3.2\shiro-root-1.3.2-source-release\shiro-root-1.3.2\samples\spring 配置web.xml 文件和 Spring 的配置文件</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>与Web 集成</span></h2><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 提供了与 Web 集成的支持，其通过一个ShiroFilter 入口来拦截需要安全控制的URL，然后进行相应的控制</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• ShiroFilter 类似于如 Strut2/SpringMVC 这种web 框架的前端控制器，是安全控制的入口点，其负责读取配置（如ini 配置文件），然后判断URL 是否需要登录/权限等工作。</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>ShiroFilter 的工作原理</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/5.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/5.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">浏览器</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">ShiroFilter</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">filterChainDefinitions</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">loginUrl</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">没有经过认证</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">经过认证或不</span><br><span style="padding-right:0.1px;">被拦截的页面</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>ShiroFilter</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• DelegatingFilterProxy 作用是自动到 Spring 容器查找名字为 shiroFilter（filter-name）的 bean 并把所有 Filter </span><br><span style="padding-right:0.1px;">的操作委托给它。</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/6.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/6.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">部分细节</span><br><span style="padding-right:0.1px;">• [urls] 部分的配置，其格式是： “url=拦截器[参数]，拦截器[参数]”；</span><br><span style="padding-right:0.1px;"><span></span></span><br><span style="padding-right:0.1px;">• 如果当前请求的 url 匹配 [urls] 部分的某个 url 模式，将会执行其配置的拦截器。</span><br><span style="padding-right:0.1px;"><span></span></span><br><span style="padding-right:0.1px;">• anon（anonymous） 拦截器表示匿名访问（即不需要登录即可访问）</span><br><span style="padding-right:0.1px;"><span></span></span><br><span style="padding-right:0.1px;">• authc （authentication）拦截器表示需要身份认证通过后才能访问</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>shiro中默认的过滤器</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/7.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/7.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>URL 匹配模式</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• url 模式使用 Ant 风格模式</span><br><span style="padding-right:0.1px;">• Ant 路径通配符支持 ?、*、**，注意通配符匹配不</span><br><span style="padding-right:0.1px;">包括目录分隔符“/”：</span><br><span style="padding-right:0.1px;">– ?：匹配一个字符，如 /admin? 将匹配 /admin1，但不</span><br><span style="padding-right:0.1px;">匹配 /admin 或 /admin/；</span><br><span style="padding-right:0.1px;">– *：匹配零个或多个字符串，如 /admin 将匹配 /admin、</span><br><span style="padding-right:0.1px;">/admin123，但不匹配 /admin/1；</span><br><span style="padding-right:0.1px;">– **：匹配路径中的零个或多个路径，如 /admin/** 将匹</span><br><span style="padding-right:0.1px;">配 /admin/a 或 /admin/a/b</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>URL 匹配顺序</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• URL 权限采取第一次匹配优先的方式，即从头开始</span><br><span style="padding-right:0.1px;">使用第一个匹配的 url 模式对应的拦截器链。</span><br><span style="padding-right:0.1px;">• 如：</span><br><span style="padding-right:0.1px;">– /bb/**=filter1</span><br><span style="padding-right:0.1px;">– /bb/aa=filter2</span><br><span style="padding-right:0.1px;">– /**=filter3</span><br><span style="padding-right:0.1px;">– 如果请求的url是“/bb/aa”，因为按照声明顺序进行匹</span><br><span style="padding-right:0.1px;">配，那么将使用 filter1 进行拦截。</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>认证</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Shiro 架构(Shiro外部来看)</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 从外部来看Shiro ，即从应用程序角度的来观察如何使用 Shiro 完成</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>工作：</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/8.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/8.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>身份验证</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 身份验证：一般需要提供如身份 ID 等一些标识信息来表明登录者的身份，如提供 email，用户名/密码来证明。</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 在 shiro 中，用户需要提供 principals （身份）和 credentials（证明）给 shiro，从而应用能验证用户身份：</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span style="padding-right:0.1px;">• principals：身份，即主体的标识属性，可以是任何属性，如用户名、邮箱等，唯一即可。一个主体可以有多个 principals，但只有一个</span><br><span style="padding-right:0.1px;">Primary principals，一般是用户名/邮箱/手机号。</span><br><span style="padding-right:0.1px;"><span></span></span><br><span style="padding-right:0.1px;">• credentials：证明/凭证，即只有主体知道的安全值，如密码/数字证书等。</span><br><span style="padding-right:0.1px;"><span></span></span><br><span style="padding-right:0.1px;">• 最常见的 principals 和 credentials 组合就是用户名/密码了</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>身份验证基本流程</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 1、收集用户身份/凭证，即如用户名/密码</span><br><span style="padding-right:0.1px;">• 2、调用 Subject.login 进行登录，如果失败将得到相应的 AuthenticationException 异常，根据异常提示用户</span><br><span style="padding-right:0.1px;">错误信息；否则登录成功</span><br><span style="padding-right:0.1px;">• 3、创建自定义的 Realm 类，继承org.apache.shiro.realm.AuthorizingRealm 类，实现doGetAuthenticationInfo() 方法</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>身份验证示例</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/9.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/9.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>AuthenticationException</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 如果身份验证失败请捕获 AuthenticationException 或其子类</span><br><span style="padding-right:0.1px;">• 最好使用如“用户名/密码错误”而不是“用户名错误”/“密码错误”，防止一些恶意用户非法扫描帐号库；</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/10.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/10.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>认证流程</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/11.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/11.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>身份认证流程</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 1、首先调用 Subject.login(token) 进行登录，其会自动委托给SecurityManager</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 2、SecurityManager 负责真正的身份验证逻辑；它会委托给Authenticator 进行身份验证；</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 3、Authenticator 才是真正的身份验证者，Shiro API 中核心的身份认证入口点，此处可以自定义插入自己的实现；</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 4、Authenticator 可能会委托给相应的 AuthenticationStrategy 进行多 Realm 身份验证，默认 ModularRealmAuthenticator 会调用AuthenticationStrategy 进行多 Realm 身份验证；</span></pre><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 5、Authenticator 会把相应的 token 传入 Realm，从 Realm 获取身份验证信息，如果没有返回/抛出异常表示身份验证失败了。此处</span><br><span style="padding-right:0.1px;">可以配置多个Realm，将按照相应的顺序及策略进行访问。</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Realm</span></h2><pre class="md-fences mock-cm md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;">• Realm：Shiro 从 Realm 获取安全数据（如用户、角色、权限），即 SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从Realm得到用户相应的角色/权限进行验证用户是否能进行操作<br><br></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>• Realm接口如下：</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/12.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/12.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><span class="md-line md-end-block" style="display:block;"><span>	</span></span></p><pre class="md-fences mock-cm md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;">• 一般继承 AuthorizingRealm（授权）即可；其继承了AuthenticatingRealm（即身份验证），而且也间接继承了CachingRealm（带有缓存实现）。<br><br></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Realm 的继承关系：</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/13.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4集成 Spring_files/13.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Authenticator</span></h2><pre class="md-fences mock-cm md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;">• Authenticator 的职责是验证用户帐号，是 Shiro API 中身份验证核心的入口点：如果验证成功，将返回AuthenticationInfo 验
证信息；此信息中包含了身份及凭证；如果验证失败将抛出相应的 AuthenticationException 异常

• SecurityManager 接口继承了 Authenticator，另外还有一个ModularRealmAuthenticator实现，其委托给多个Realm 进行
验证，验证规则通过 AuthenticationStrategy 接口指定<br><br></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>AuthenticationStrategy</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>AuthenticationStrategy 接口的默认实现：</span></h3><pre class="md-fences mock-cm md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;">• FirstSuccessfulStrategy：只要有一个 Realm 验证成功即可，只返回第一个 Realm 身份验证成功的认证信息，其他的忽略；<br><br></pre><pre class="md-fences mock-cm md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;">• AtLeastOneSuccessfulStrategy：只要有一个Realm验证成功即可，和FirstSuccessfulStrategy 不同，将返回所有Realm身份验证成功的认证信息；
• AllSuccessfulStrategy：所有Realm验证成功才算成功，且返回所有Realm身份验证成功的认证信息，如果有一个失败就失败了。

• ModularRealmAuthenticator 默认是 AtLeastOneSuccessfulStrategy
策略<br><br></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><br class="Apple-interchange-newline"></p></p></p></p></p></p></p><span></span></p></body></html>