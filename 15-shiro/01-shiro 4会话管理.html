<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>01-shiro 4会话管理</title>
    
<style id="wiz_custom_css">html, body {font-size: 12pt;}body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.6;margin: 0 auto;padding: 20px 16px;padding: 1.25rem 1rem;}h1, h2, h3, h4, h5, h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}h1 {font-size:20pt;font-size:1.67rem;}h2 {font-size:18pt;font-size:1.5rem;}h3 {font-size:15pt;font-size:1.25rem;}h4 {font-size:14pt;font-size:1.17rem;}h5 {font-size:12pt;font-size:1rem;}h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}div, p, ul, ol, dl, li {margin:0;}blockquote, table, pre, code {margin:8px 0;}ul, ol {padding-left:32px;padding-left:2rem;}ol.wiz-list-level1 > li {list-style-type:decimal;}ol.wiz-list-level2 > li {list-style-type:lower-latin;}ol.wiz-list-level3 > li {list-style-type:lower-roman;}blockquote {padding:0 12px;padding:0 0.75rem;}blockquote > :first-child {margin-top:0;}blockquote > :last-child {margin-bottom:0;}img {border:0;max-width:100%;height:auto !important;margin:2px 0;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td, th {padding:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;min-height:28px;word-break:break-all;box-sizing: border-box;}.wiz-hide {display:none !important;}</style></head>

<body class=""  spellcheck="false"><div></div><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>会话管理</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>概述</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 提供了完整的企业级会话管理功能，不依赖于底层容器（如web容器tomcat），不管 JavaSE 还是 JavaEE 环境都可以使用，提供了会话管理、会话事件监听、会话存储/持久化、容器无关的集群、失效/过期支持、对Web 的透明支持、SSO 单点登录的支持等特性。</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>会话相关的 API</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Subject.getSession()：即可获取会话；其等价于</span><br><span style="padding-right:0.1px;">Subject.getSession(true)，即如果当前没有创建 Session 对象会创建一个；Subject.getSession(false)，如果当前没有创建 Session 则返回null</span><br><span style="padding-right:0.1px;">• session.getId()：获取当前会话的唯一标识</span><br><span style="padding-right:0.1px;">• session.getHost()：获取当前Subject的主机地址</span><br><span style="padding-right:0.1px;">• session.getTimeout() &amp; session.setTimeout(毫秒)：获取/设置当</span><br><span style="padding-right:0.1px;">前Session的过期时间</span><br><span style="padding-right:0.1px;">• session.getStartTimestamp() &amp; session.getLastAccessTime()：获取会话的启动时间及最后访问时间；如果是 JavaSE 应用需要自己定期调用 session.touch() 去更新最后访问时间；如果是 Web 应用，每次进入 ShiroFilter 都会自动调用 session.touch() 来更新最后访问时间。</span><br><span style="padding-right:0.1px;">• session.touch() &amp; session.stop()：更新会话最后访问时间及销毁会话；当Subject.logout()时会自动调用 stop 方法来销毁会话。如果在web中，调用 HttpSession. invalidate() 也会自动调用Shiro Session.stop 方法进行销毁Shiro 的会话</span><br><span style="padding-right:0.1px;">• session.setAttribute(key, val) &amp; session.getAttribute(key) &amp; session.removeAttribute(key)：设置/获取/删除会话属性；在整个会话范围内都可以对这些属性进行操作</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>会话监听器</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">会话监听器用于监听会话创建、过期及停止事件</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/30.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/30.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>SessionDao</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/31.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/31.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• AbstractSessionDAO 提供了 SessionDAO 的基础实现，如生成会话ID等</span><br><span style="padding-right:0.1px;">• CachingSessionDAO 提供了对开发者透明的会话缓存的功能，需要设置相应的 CacheManager</span><br><span style="padding-right:0.1px;">• MemorySessionDAO 直接在内存中进行会话维护</span><br><span style="padding-right:0.1px;">• EnterpriseCacheSessionDAO 提供了缓存功能的会话维护，默认情况下使用 MapCache 实现，内部使用ConcurrentHashMap 保存缓存的会话。</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>配置示例</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/32.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/32.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/33.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/33.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>使用redis缓存session</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Session Dao</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/34.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/34.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>SerializableUtils</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/35.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/35.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>会话验证</span></h2><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 提供了会话验证调度器，用于定期的验证会话是否已过期，如果过期将停止会话</span><br><span style="padding-right:0.1px;">• 出于性能考虑，一般情况下都是获取会话时来验证会话是否过期并停止会话的；但是如在 web 环境中，如果用户不</span><br><span style="padding-right:0.1px;">主动退出是不知道会话是否过期的，因此需要定期的检测会话是否过期，Shiro 提供了会话验证调度器SessionValidationScheduler</span><br><span style="padding-right:0.1px;">• Shiro 也提供了使用Quartz会话验证调度器：QuartzSessionValidationScheduler</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>缓存</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>CacheManagerAware 接口</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 内部相应的组件（DefaultSecurityManager）会自动检测相应的对象（如Realm）是否实现了CacheManagerAware 并自动注入相应的CacheManager。</span></pre><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Realm 缓存</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 提供了 CachingRealm，其实现了CacheManagerAware 接口，提供了缓存的一些基础实现；</span><br><span style="padding-right:0.1px;">• AuthenticatingRealm 及 AuthorizingRealm 也分别提供了对AuthenticationInfo 和 AuthorizationInfo 信息的缓存。</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>Session 缓存</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 如 SecurityManager 实现了 SessionSecurityManager，其会判断 SessionManager 是否实现了CacheManagerAware 接口，如果实现了会把CacheManager 设置给它。</span><br><span style="padding-right:0.1px;">• SessionManager 也会判断相应的 SessionDAO（如继承自CachingSessionDAO）是否实现了CacheManagerAware，如果实现了会把 CacheManager设置给它</span><br><span style="padding-right:0.1px;">• 设置了缓存的 SessionManager，查询时会先查缓存，如果找不到才查数据库。</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>RememberMe</span></h2><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>概述</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• Shiro 提供了记住我（RememberMe）的功能，比如访问如淘宝等一些网站时，关闭了浏览器，下次再打开时还是能记住你是谁，下次访问时无需再登录即可访问，基本流程如下：</span><br><span style="padding-right:0.1px;">• 1、首先在登录页面选中 RememberMe 然后登录成功；如果是浏览器登录，一般会把 RememberMe 的Cookie 写到客户端并保存下来；</span><br><span style="padding-right:0.1px;">• 2、关闭浏览器再重新打开；会发现浏览器还是记住你的；</span><br><span style="padding-right:0.1px;">• 3、访问一般的网页服务器端还是知道你是谁，且能正常访问；</span><br><span style="padding-right:0.1px;">• 4、但是比如我们访问淘宝时，如果要查看我的订单或进行支付时，此时还是需要再进行身份认证的，以确保当前用户还是你。</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>认证和记住我</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• subject.isAuthenticated() 表示用户进行了身份验证登录的，即使有 Subject.login 进行了登录；</span><br><span style="padding-right:0.1px;">• subject.isRemembered()：表示用户是通过记住我登录的，此时可能并不是真正的你（如你的朋友使用你的电脑，或者你的cookie 被窃取）在访问的</span><br><span style="padding-right:0.1px;">• 两者二选一，即 subject.isAuthenticated()==true，则subject.isRemembered()==false；反之一样。</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>建议</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 访问一般网页：如个人在主页之类的，我们使用user 拦截器即可，user 拦截器只要用户登录(isRemembered() || isAuthenticated())过即可访问成功；</span><br><span style="padding-right:0.1px;">• 访问特殊网页：如我的订单，提交订单页面，我们使用authc 拦截器即可，authc 拦截器会判断用户是否是通过Subject.login（isAuthenticated()==true）登录的，如果是才放行，否则会跳转到登录页面叫你重新登录。</span></pre><h2 class="md-end-block md-heading" style="font-size:1.75rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;padding-bottom:0.3em;border-bottom:1px solid rgb(238, 238, 238);color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>身份验证相关的</span></h2><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/36.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/36.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>实现</span></h3><pre class="md-fences md-end-block" style="font-family:Consolas, &quot;Liberation Mono&quot;, Courier, monospace;font-size:0.9rem;display:block;text-align:left;background-position:var(--code-block-bg-color);background-repeat:var(--code-block-bg-color);background-color:rgb(248, 248, 248);border:1px solid rgb(221, 221, 221);border-radius:3px;padding:8px 1em 6px;margin-bottom:15px;margin-top:15px;color:rgb(51, 51, 51);font-style:normal;font-weight:normal;text-indent:0px;"><span></span><br><span style="padding-right:0.1px;">• 如果要自己做RememeberMe，需要在登录之前这样创建Token：</span><br><span style="padding-right:0.1px;">UsernamePasswordToken(用户名，密码，是否记住我)，且调用</span><br><span style="padding-right:0.1px;">UsernamePasswordToken 的：token.setRememberMe(true); 方法</span></pre><h3 class="md-end-block md-heading" style="font-size:1.5rem;margin-top:1rem;margin-bottom:1rem;font-weight:bold;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;text-align:start;text-indent:0px;"><span>配置</span></h3><p style="margin:0.8em 0px;color:rgb(51, 51, 51);font-family:&quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:1.333rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;"><span class="md-line md-end-block" style="display:block;"><span data-src="mdpic/37.bmp" class="md-image md-img-loaded" style="font-family:monospace;display:inline-block;width:690.51px;text-align:center;"><img src="01-shiro 4会话管理_files/37.bmp" style="box-sizing: border-box; border-width: 0px 4px 0px 2px; border-top-style: initial; border-right-style: solid; border-bottom-style: initial; border-left-style: solid; border-top-color: initial; border-right-color: transparent; border-bottom-color: initial; border-left-color: transparent; border-image: initial; vertical-align: middle; max-width: 100%; cursor: default;"></span></span></p><br class="Apple-interchange-newline"></p><span></span></p></p></p></p><span></span></p><span></span></p></body></html>